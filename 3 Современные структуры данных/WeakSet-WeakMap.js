// WeakMap ‚Äì —ç—Ç–æ Map-–ø–æ–¥–æ–±–Ω–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è, –ø–æ–∑–≤–æ–ª—è—é—â–∞—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∫–ª—é—á–µ–π —Ç–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç—ã, –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—â–∞—è –∏—Ö –≤–º–µ—Å—Ç–µ —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –æ–Ω–∏ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –Ω–µ–¥–æ—Å—Ç–∏–∂–∏–º—ã–º–∏ –∏–Ω—ã–º–∏ –ø—É—Ç—è–º–∏.

// WeakSet ‚Äì —ç—Ç–æ Set-–ø–æ–¥–æ–±–Ω–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è —Ö—Ä–∞–Ω–∏—Ç —Ç–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç—ã –∏ —É–¥–∞–ª—è–µ—Ç –∏—Ö, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –æ–Ω–∏ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –Ω–µ–¥–æ—Å—Ç–∏–∂–∏–º—ã–º–∏ –∏–Ω—ã–º–∏ –ø—É—Ç—è–º–∏.

// –û–±–µ —ç—Ç–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –º–µ—Ç–æ–¥—ã –∏ —Å–≤–æ–π—Å—Ç–≤–∞, —Ä–∞–±–æ—Ç–∞—é—â–∏–µ —Å–æ –≤—Å–µ–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º —Å—Ä–∞–∑—É –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–∞–∑–º–µ—Ä–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏. –í–æ–∑–º–æ–∂–Ω—ã —Ç–æ–ª—å–∫–æ –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–º —ç–ª–µ–º–µ–Ω—Ç–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏.

// WeakMap –∏ WeakSet –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–∞–∫ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –≤ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ ¬´–æ—Å–Ω–æ–≤–Ω–æ–º—É¬ª –º–µ—Å—Ç—É —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞. –ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∏ –Ω–∏–≥–¥–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –∫—Ä–æ–º–µ –∫–∞–∫ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∫–ª—é—á–∞ –≤ WeakMap –∏–ª–∏ –≤ WeakSet, —Ç–æ –æ–Ω –±—É–¥–µ—Ç —É–¥–∞–ª—ë–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

// ¬´–ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç –±–æ–ª—å—à–µ –Ω–∏–≥–¥–µ –Ω–µ –Ω—É–∂–µ–Ω ‚Äî –ø—É—Å—Ç—å —Å–±–æ—Ä—â–∏–∫ –º—É—Å–æ—Ä–∞ –µ–≥–æ —É–¥–∞–ª–∏—Ç, –∞ –º—ã –Ω–µ –±—É–¥–µ–º –º–µ—à–∞—Ç—å¬ª
// WeakSet ‚Äî —ç—Ç–æ:
// –∫–æ–ª–ª–µ–∫—Ü–∏—è
// –¢–û–õ–¨–ö–û –æ–±—ä–µ–∫—Ç–æ–≤
// –±–µ–∑ –ø–µ—Ä–µ–±–æ—Ä–∞
// –±–µ–∑ size
const visitedUsers = new WeakSet();

let user = { name: 'Kate' };

visitedUsers.add(user);
visitedUsers.has(user); // true

user = null;
// –æ–±—ä–µ–∫—Ç —É–¥–∞–ª–∏—Ç—Å—è —Å–±–æ—Ä—â–∏–∫–æ–º –º—É—Å–æ—Ä–∞
// –∑–∞–ø–∏—Å—å –≤ WeakSet –∏—Å—á–µ–∑–Ω–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

// | –ß—Ç–æ –Ω–µ–ª—å–∑—è | –ü–æ—á–µ–º—É                              |
// | ---------- | ----------------------------------- |
// | –ü—Ä–∏–º–∏—Ç–∏–≤—ã  | –û–Ω–∏ –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è —Å–±–æ—Ä—â–∏–∫–æ–º –º—É—Å–æ—Ä–∞   |
// | for...of   | –ù–µ–ª—å–∑—è –¥–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –æ–±—ä–µ–∫—Ç–∞–º |
// | size       | JS —Å–∞–º —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø–∞–º—è—Ç—å—é            |

// WeakMap ‚Äî —ç—Ç–æ:
// –ø–∞—Ä—ã –∫–ª—é—á ‚Üí –∑–Ω–∞—á–µ–Ω–∏–µ
// –∫–ª—é—á = –¢–û–õ–¨–ö–û –æ–±—ä–µ–∫—Ç
// –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî —á—Ç–æ —É–≥–æ–¥–Ω–æ
// –¥–∞–Ω–Ω—ã–µ ¬´–ø—Ä–∏–≤—è–∑–∞–Ω—ã¬ª –∫ –æ–±—ä–µ–∫—Ç—É
const meta = new WeakMap();
let userE = { name: 'Alex' };

meta.set(user, { lastVisit: 'today' });

meta.get(user); // { lastVisit: 'today' }

user = null;
// –æ–±—ä–µ–∫—Ç —É–¥–∞–ª–∏—Ç—Å—è
// –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ç–æ–∂–µ

// üß† –ú—ã –∫–∞–∫ –±—É–¥—Ç–æ –ø—Ä–∏–∫–ª–µ–∏–≤–∞–µ–º —Å—Ç–∏–∫–µ—Ä –∫ –æ–±—ä–µ–∫—Ç—É, –Ω–æ –µ—Å–ª–∏ –æ–±—ä–µ–∫—Ç –≤—ã–±—Ä–æ—Å–∏–ª–∏ ‚Äî —Å—Ç–∏–∫–µ—Ä —Ç–æ–∂–µ –∏—Å—á–µ–∑.

// –ö–æ–≥–¥–∞ —Ä–µ–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç WeakSet / WeakMap
// 1. –ü–æ–º–µ—Ç–∫–∏ ¬´–±—ã–ª / –Ω–µ –±—ã–ª¬ª
const visited = new WeakSet();

function visit(user) {
	if (visited.has(user)) {
		console.log('–£–∂–µ –±—ã–ª');
	} else {
		visited.add(user);
		console.log('–ü–µ—Ä–≤—ã–π —Ä–∞–∑');
	}
}

// 2. –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∫ –æ–±—ä–µ–∫—Ç–∞–º
const cache = new WeakMap();

function process(obj) {
	if (!cache.has(obj)) {
		cache.set(obj, heavyCalculation(obj));
	}
	return cache.get(obj);
}

// 3. DOM-—ç–ª–µ–º–µ–Ω—Ç—ã
const listeners = new WeakMap();

listeners.set(button, handler);

// | –ö–æ–ª–ª–µ–∫—Ü–∏—è | –•—Ä–∞–Ω–∏—Ç         | –ü–µ—Ä–µ–±–æ—Ä | size | –°–±–æ—Ä–∫–∞ –º—É—Å–æ—Ä–∞ |
// | --------- | -------------- | ------- | ---- | ------------- |
// | Set       | –ª—é–±—ã–µ          | ‚úÖ       | ‚úÖ    | ‚ùå             |
// | Map       | –ª—é–±—ã–µ –∫–ª—é—á–∏    | ‚úÖ       | ‚úÖ    | ‚ùå             |
// | WeakSet   | —Ç–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç—ã | ‚ùå       | ‚ùå    | ‚úÖ             |
// | WeakMap   | –∫–ª—é—á = –æ–±—ä–µ–∫—Ç  | ‚ùå       | ‚ùå    | ‚úÖ             |

// ‚ùì –î–æ–ª–∂–Ω—ã –ª–∏ –¥–∞–Ω–Ω—ã–µ –∏—Å—á–µ–∑–Ω—É—Ç—å –≤–º–µ—Å—Ç–µ —Å –æ–±—ä–µ–∫—Ç–æ–º?
// –î–ê ‚Üí WeakMap / WeakSet
// –ù–ï–¢ ‚Üí Map / Set
