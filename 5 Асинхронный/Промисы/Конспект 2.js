// Promise API ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ù–ï–°–ö–û–õ–¨–ö–ò–ú–ò –ø—Ä–æ–º–∏—Å–∞–º–∏

/* 0) –ó–∞—á–µ–º –≤–æ–æ–±—â–µ –Ω—É–∂–µ–Ω Promise API
–î–æ —ç—Ç–æ–≥–æ:
- –æ–¥–∏–Ω Promise ‚Üí then / catch ‚Üí —Ü–µ–ø–æ—á–∫–∞

–¢–µ–ø–µ—Ä—å:
- —É –Ω–∞—Å –ù–ï–°–ö–û–õ–¨–ö–û –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –Ω—É–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –∏–º–∏ –ö–ê–ö –ì–†–£–ü–ü–û–ô

–¢–∏–ø–æ–≤—ã–µ –∑–∞–¥–∞—á–∏:
- –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- –¥–æ–∂–¥–∞—Ç—å—Å—è –≤—Å–µ—Ö
- –≤–∑—è—Ç—å –ø–µ—Ä–≤—ã–π —É—Å–ø–µ—à–Ω—ã–π
- –≤–∑—è—Ç—å —Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π
- —É–∑–Ω–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–∞–∂–¥–æ–≥–æ (–¥–∞–∂–µ –µ—Å–ª–∏ —á–∞—Å—Ç—å —É–ø–∞–ª–∞)

Promise API = –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ú–ê–°–°–ò–í–û–ú –ø—Ä–æ–º–∏—Å–æ–≤

–ê–Ω–∞–ª–æ–≥–∏—è:
–¢—ã –∑–∞–∫–∞–∑–∞–ª–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –±–ª—é–¥ üçùüç£üç∞
- all ‚Üí ‚Äú–ø—Ä–∏–Ω–µ—Å–∏—Ç–µ –í–°–Å —Å—Ä–∞–∑—É, –∏–ª–∏ –æ—Ç–º–µ–Ω–∞‚Äù
- allSettled ‚Üí ‚Äú–ø—Ä–∏–Ω–µ—Å–∏—Ç–µ –æ—Ç—á—ë—Ç –ø–æ –∫–∞–∂–¥–æ–º—É –∑–∞–∫–∞–∑—É‚Äù
- any ‚Üí ‚Äú–¥–∞–π—Ç–µ –õ–Æ–ë–û–ï –≥–æ—Ç–æ–≤–æ–µ –±–ª—é–¥–æ‚Äù
- race ‚Üí ‚Äú–∫—Ç–æ –ø–µ—Ä–≤—ã–π ‚Äî —Ç–æ–≥–æ –∏ –µ–º‚Äù

1) Promise.all ‚Äî ¬´–≤—Å–µ –∏–ª–∏ –Ω–∏—á–µ–≥–æ¬ª
----------------------------------------------------------------------------
Promise.all(promises)
‚Üí –≤–µ—Ä–Ω—ë—Ç –û–î–ò–ù promise

–û–Ω:
- fulfilled ‚Üí –∫–æ–≥–¥–∞ –í–°–ï –ø—Ä–æ–º–∏—Å—ã fulfilled
- rejected ‚Üí –∫–∞–∫ —Ç–æ–ª—å–∫–æ –•–û–¢–Ø –ë–´ –û–î–ò–ù rejected

–í–ê–ñ–ù–û (learn):
- –µ—Å–ª–∏ –æ–¥–∏–Ω —É–ø–∞–ª ‚Üí –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Ä—è—é—Ç—Å—è
- –ø–æ—Ä—è–¥–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ = –ø–æ—Ä—è–¥–æ–∫ –≤ –º–∞—Å—Å–∏–≤–µ, –Ω–µ —Å–∫–æ—Ä–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è */

const p1 = Promise.resolve(1);
const p2 = Promise.resolve(2);
const p3 = Promise.resolve(3);

Promise.all([p1, p2, p3])
	.then(results => {
		// results = [1, 2, 3]
		console.log(results);
	})
	.catch(error => {
		// –µ—Å–ª–∏ –õ–Æ–ë–û–ô –ø—Ä–æ–º–∏—Å —É–ø–∞–ª ‚Üí —Å—é–¥–∞
		console.error(error);
	});

/* –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
‚úî –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
‚úî –Ω—É–∂–Ω—ã –í–°–ï –¥–∞–Ω–Ω—ã–µ
‚úñ –Ω–µ–ª—å–∑—è —Ç–µ—Ä—è—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–∑-–∑–∞ –æ–¥–Ω–æ–π –æ—à–∏–±–∫–∏ */

/* 2) Promise.allSettled ‚Äî ¬´–¥–∞–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–∞–∂–¥–æ–≥–æ¬ª
----------------------------------------------------------------------------
Promise.allSettled(promises)

–û–Ω:
- –ù–ò–ö–û–ì–î–ê –Ω–µ –ø–∞–¥–∞–µ—Ç (always fulfilled)
- –∂–¥—ë—Ç, –ø–æ–∫–∞ –ó–ê–í–ï–†–®–ê–¢–°–Ø –í–°–ï –ø—Ä–æ–º–∏—Å—ã
- –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤-–æ—Ç—á—ë—Ç–æ–≤

–§–æ—Ä–º–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (doka):
{
  status: "fulfilled",
  value: ...
}
–∏–ª–∏
{
  status: "rejected",
  reason: ...
} */

const ok = Promise.resolve('OK');
const fail = Promise.reject('ERROR');

Promise.allSettled([ok, fail]).then(results => {
	console.log(results);
	/*
  [
    { status: "fulfilled", value: "OK" },
    { status: "rejected", reason: "ERROR" }
  ]
  */
});

/* –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
‚úî –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å, –ß–¢–û –ò–ú–ï–ù–ù–û —É–ø–∞–ª–æ
‚úî –∞–Ω–∞–ª–∏—Ç–∏–∫–∞, –æ—Ç—á—ë—Ç—ã, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚úî –Ω–µ–ª—å–∑—è ‚Äú–æ–±—Ä—ã–≤–∞—Ç—å‚Äù –ø—Ä–æ—Ü–µ—Å—Å –∏–∑-–∑–∞ –æ—à–∏–±–æ–∫ */

/* 3) Promise.race ‚Äî ¬´–∫—Ç–æ –ø–µ—Ä–≤—ã–π, —Ç–æ–≥–æ –∏ —Ç–∞–ø–∫–∏¬ª
----------------------------------------------------------------------------
Promise.race(promises)

–û–Ω:
- –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –ö–ê–ö –¢–û–õ–¨–ö–û –ü–ï–†–í–´–ô –ø—Ä–æ–º–∏—Å –∑–∞–≤–µ—Ä—à–∏–ª—Å—è
- –Ω–µ–≤–∞–∂–Ω–æ: fulfilled –∏–ª–∏ rejected
- —Ä–µ–∑—É–ª—å—Ç–∞—Ç = —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–µ—Ä–≤–æ–≥–æ

–í–ê–ñ–ù–û:
- –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–æ–º–∏—Å—ã –ù–ï –æ—Ç–º–µ–Ω—è—é—Ç—Å—è
- –º—ã –ø—Ä–æ—Å—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç */

const fast = new Promise(res => setTimeout(() => res('fast'), 100));
const slow = new Promise(res => setTimeout(() => res('slow'), 500));

Promise.race([fast, slow]).then(result => {
	console.log(result); // "fast"
});

/* –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
‚úî —Ç–∞–π–º–∞—É—Ç—ã (–∑–∞–ø—Ä–æ—Å –∏–ª–∏ —Ç–∞–π–º–µ—Ä)
‚úî –≤—ã–±—Ä–∞—Ç—å —Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫
‚úñ –Ω–µ–ª—å–∑—è, –µ—Å–ª–∏ –Ω—É–∂–µ–Ω ‚Äú—É—Å–ø–µ—à–Ω—ã–π, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–≤—ã–π‚Äù */

/* 4) Promise.any ‚Äî ¬´–ª—é–±–æ–π —É—Å–ø–µ—à–Ω—ã–π¬ª
----------------------------------------------------------------------------
Promise.any(promises)

–û–Ω:
- fulfilled ‚Üí –∫–∞–∫ —Ç–æ–ª—å–∫–æ –ü–ï–†–í–´–ô fulfilled
- rejected ‚Üí –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –í–°–ï rejected
- –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –æ—à–∏–±–∫–∏, –ø–æ–∫–∞ –µ—Å—Ç—å –Ω–∞–¥–µ–∂–¥–∞ –Ω–∞ —É—Å–ø–µ—Ö

–ï—Å–ª–∏ –≤—Å–µ —É–ø–∞–ª–∏ ‚Üí AggregateError */

const bad1 = Promise.reject('fail 1');
const bad2 = Promise.reject('fail 2');
const good = Promise.resolve('SUCCESS');

Promise.any([bad1, bad2, good])
	.then(value => {
		console.log(value); // "SUCCESS"
	})
	.catch(err => {
		// err instanceof AggregateError
		console.error(err.errors);
	});

/* –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
‚úî —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö
‚úî ‚Äú–¥–∞–π —Ö–æ—Ç—å –æ–¥–∏–Ω —Ä–∞–±–æ—á–∏–π –≤–∞—Ä–∏–∞–Ω—Ç‚Äù
‚úñ –µ—Å–ª–∏ –≤–∞–∂–Ω—ã –æ—à–∏–±–∫–∏ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ */

/* 5) –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ (–û–ß–ï–ù–¨ –í–ê–ñ–ù–û)

| –ú–µ—Ç–æ–¥            | –ö–æ–≥–¥–∞ fulfilled                      | –ö–æ–≥–¥–∞ rejected                     |
|------------------|--------------------------------------|------------------------------------|
| Promise.all      | –≤—Å–µ fulfilled                        | –ø–µ—Ä–≤—ã–π rejected                    |
| Promise.allSettled | –≤—Å–µ–≥–¥–∞ fulfilled                   | –Ω–∏–∫–æ–≥–¥–∞                            |
| Promise.race     | –ø–µ—Ä–≤—ã–π –∑–∞–≤–µ—Ä—à–∏–≤—à–∏–π—Å—è                 | –µ—Å–ª–∏ –ø–µ—Ä–≤—ã–π rejected               |
| Promise.any      | –ø–µ—Ä–≤—ã–π fulfilled                     | –µ—Å–ª–∏ –í–°–ï rejected                  |

----------------------------------------------------------------------------
6) async/await + Promise API ‚Äî –∫–∞–∫ —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç –≤ –∂–∏–∑–Ω–∏

–í–ê–ñ–ù–û:
- await —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –†–ï–ó–£–õ–¨–¢–ê–¢–û–ú Promise API
- Promise.all / any / race / allSettled ‚Üí –≤—Å—ë –µ—â—ë –ø—Ä–æ–º–∏—Å—ã */

async function loadData() {
	try {
		const results = await Promise.all([
			fetch('/user'),
			fetch('/posts'),
			fetch('/comments'),
		]);

		// results = [Response, Response, Response]
		return results;
	} catch (e) {
		// –µ—Å–ª–∏ –õ–Æ–ë–û–ô fetch —É–ø–∞–ª
		console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', e);
	}
}

/* 7) –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –Ω–æ–≤–∏—á–∫–æ–≤
----------------------------------------------------------------------------
‚ùå –¥—É–º–∞—Ç—å, —á—Ç–æ Promise.all –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ–º–∏—Å—ã –ø–æ –æ—á–µ—Ä–µ–¥–∏
‚Üí –ù–ï–¢, –æ–Ω–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –°–†–ê–ó–£

‚ùå –¥—É–º–∞—Ç—å, —á—Ç–æ Promise.race –æ—Ç–º–µ–Ω—è–µ—Ç –æ—Å—Ç–∞–ª—å–Ω—ã–µ
‚Üí –ù–ï–¢, –ø—Ä–æ—Å—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç

‚ùå –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Promise.all, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ —á–∞—Å—Ç–∏—á–Ω–∞—è —É—Å–ø–µ—à–Ω–æ—Å—Ç—å
‚Üí –Ω–∞–¥–æ allSettled –∏–ª–∏ any

============================================================================
8) –ó–æ–ª–æ—Ç—ã–µ –ø—Ä–∞–≤–∏–ª–∞ (–∑–∞–ø–æ–º–Ω–∏—Ç—å)
----------------------------------------------------------------------------
1) Promise.all ‚Üí ‚Äú–∏–ª–∏ –≤—Å—ë, –∏–ª–∏ –Ω–∏—á–µ–≥–æ‚Äù
2) Promise.allSettled ‚Üí ‚Äú–æ—Ç—á—ë—Ç –ø–æ –∫–∞–∂–¥–æ–º—É‚Äù
3) Promise.race ‚Üí ‚Äú–ø–µ—Ä–≤—ã–π –∑–∞–≤–µ—Ä—à–∏–≤—à–∏–π—Å—è‚Äù
4) Promise.any ‚Üí ‚Äú–ø–µ—Ä–≤—ã–π —É—Å–ø–µ—à–Ω—ã–π‚Äù
5) –í—Å–µ –º–µ—Ç–æ–¥—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –û–î–ò–ù Promise
6) await –º–æ–∂–Ω–æ —Å—Ç–∞–≤–∏—Ç—å –ø–µ—Ä–µ–¥ –õ–Æ–ë–´–ú –∏–∑ –Ω–∏—Ö

============================================================================
9) –ú–∏–Ω–∏-—à–ø–∞—Ä–≥–∞–ª–∫–∞ –≤—ã–±–æ—Ä–∞
----------------------------------------------------------------------------
–ù—É–∂–Ω–æ –í–°–Å –∏ —Å—Ç—Ä–æ–≥–æ ‚Üí Promise.all
–ù—É–∂–µ–Ω –æ—Ç—á—ë—Ç –ø–æ –≤—Å–µ–º ‚Üí Promise.allSettled
–ù—É–∂–µ–Ω —Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π ‚Üí Promise.race
–ù—É–∂–µ–Ω —Ö–æ—Ç—å –æ–¥–∏–Ω —É—Å–ø–µ—Ö ‚Üí Promise.any */
