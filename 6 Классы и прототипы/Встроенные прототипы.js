/* =========================================================
   JavaScript — ВСТРОЕННЫЕ ПРОТОТИПЫ
   Конспект (для чтения прямо в коде)
   ========================================================= */

/*
ПРОТОТИП — это объект, от которого другой объект
наследует свойства и методы.

ВАЖНО:
- Методы (map, toString, includes и т.д.) НЕ лежат
  в самих объектах
- Они лежат в ПРОТОТИПАХ
- JavaScript ищет свойство по цепочке прототипов вверх
*/

/* =========================================================
   ОСНОВНЫЕ ПОНЯТИЯ
   ========================================================= */

/*
[[Prototype]]
— скрытая внутренняя ссылка на прототип объекта.
Напрямую её не видно, но она есть у КАЖДОГО объекта.
*/

/*
__proto__
— accessor (геттер/сеттер) к [[Prototype]]
— устаревший способ
— в продакшене использовать НЕ рекомендуется
*/

/*
Object.getPrototypeOf(obj)
— современный и безопасный способ получить прототип
*/

/*
prototype (свойство функций)
— есть ТОЛЬКО у функций-конструкторов
— именно этот объект становится прототипом
  у экземпляров, созданных через new
*/

/* =========================================================
   КАК JS ИЩЕТ СВОЙСТВО
   ========================================================= */

/*
Когда мы пишем:

obj.prop

JavaScript делает следующее:

1) Ищет prop в самом obj
2) Если не нашёл — идёт в obj.[[Prototype]]
3) Потом в прототип прототипа
4) Доходит до Object.prototype
5) Если нигде нет — undefined

Это называется ЦЕПОЧКА ПРОТОТИПОВ
*/

/* =========================================================
   ОБЩАЯ СТРУКТУРА ПРОТОТИПОВ
   ========================================================= */

/*
Пример цепочки для массива:

[1, 2, 3]
  ↓
Array.prototype
  ↓
Object.prototype
  ↓
null   ← конец цепочки
*/

/* =========================================================
   Object.prototype
   ========================================================= */

/*
Object.prototype — корень почти всех объектов.

Методы отсюда доступны:
- объектам
- массивам
- функциям
- датам
- regex и т.д.

Примеры методов:
- toString()
- hasOwnProperty()
- valueOf()
- isPrototypeOf()
*/

/* =========================================================
   Array.prototype
   ========================================================= */

/*
Array.prototype содержит методы массивов.

ВАЖНО:
- массив НЕ хранит эти методы внутри себя
- он "смотрит" в Array.prototype

Методы:
- map
- filter
- reduce
- forEach
- push / pop
- slice / splice
*/

/* пример */
const numbers = [1, 2, 3];
numbers.map(n => n * 2);

/* =========================================================
   String.prototype
   ========================================================= */

/*
String.prototype содержит методы строк.

Хотя строка — примитив,
JavaScript временно оборачивает её в объект String,
чтобы дать доступ к методам.
*/

const str = 'JavaScript';
str.toUpperCase();
str.includes('Script');
str.slice(0, 4);

/* =========================================================
   Number.prototype
   ========================================================= */

/*
Number.prototype — методы чисел.

Используется реже напрямую,
но принцип тот же.
*/

const num = 10;
num.toFixed(2);

/* =========================================================
   Function.prototype
   ========================================================= */

/*
Function.prototype — прототип ВСЕХ функций.

Методы:
- call
- apply
- bind

Поэтому ЛЮБАЯ функция может их вызывать.
*/

function test() {}
test.call(null);

/* =========================================================
   Date.prototype
   ========================================================= */

/*
Date.prototype — методы работы с датами и временем.
*/

const now = new Date();
now.getFullYear();
now.toISOString();

/* =========================================================
   RegExp.prototype
   ========================================================= */

/*
RegExp.prototype — методы регулярных выражений.
*/

const regex = /js/i;
regex.test('JavaScript');

/* =========================================================
   Object.create и ручная цепочка прототипов
   ========================================================= */

/*
Object.create(proto) создаёт объект,
у которого proto становится прототипом.
*/

const grandParent = { grand: 'grand' };
const parent = Object.create(grandParent);
parent.parent = 'parent';
const child = Object.create(parent);
child.child = 'child';

/*
Цепочка:

child → parent → grandParent → Object.prototype → null
*/

child.child; // своё свойство
child.parent; // найдено в parent
child.grand; // найдено в grandParent

/* =========================================================
   hasOwnProperty
   ========================================================= */

/*
hasOwnProperty проверяет,
есть ли свойство У САМОГО объекта,
а не в прототипе.
*/

child.hasOwnProperty('child'); // true
child.hasOwnProperty('parent'); // false
child.hasOwnProperty('grand'); // false

/* =========================================================
   ПОЧЕМУ НЕЛЬЗЯ МЕНЯТЬ ВСТРОЕННЫЕ ПРОТОТИПЫ
   ========================================================= */

/*
Array.prototype.myMethod = ...

ПЛОХО потому что:
1) Ломаешь сторонний код
2) Возможны конфликты имён
3) Ломаешь ожидания других разработчиков
4) Можешь убить оптимизации движка
*/

/*
ПРАВИЛЬНО:
- писать утилитарные функции
- использовать классы
- не трогать глобальные прототипы
*/

/* =========================================================
   КОРОТКОЕ РЕЗЮМЕ
   ========================================================= */

/*
- У каждого объекта есть прототип
- Прототипы образуют цепочку
- Методы лежат в prototype, а не в объектах
- JS ищет свойства снизу вверх
- Object.prototype — общий базовый уровень
- Встроенные прототипы НЕ модифицируем
*/
